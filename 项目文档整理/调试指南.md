# 调试指南

本文档提供完整的调试方法,帮助您快速定位和解决问题。

---

## 📋 目录

1. [GitHub Actions 构建调试](#github-actions-构建调试)
2. [APK 安装和运行调试](#apk-安装和运行调试)
3. [应用日志查看](#应用日志查看)
4. [常见问题排查](#常见问题排查)
5. [本地开发调试](#本地开发调试)

---

## 🔧 GitHub Actions 构建调试

### 1. 查看构建日志

**步骤:**
```
1. 访问项目页面: https://github.com/369219053/wework-auto-reply
2. 点击顶部的 "Actions" 标签
3. 点击最新的构建任务
4. 点击 "build" 查看详细日志
5. 展开每个步骤查看具体输出
```

**快速定位错误:**
- 查看页面右侧的 "Annotations" 区域
- 红色的错误信息会直接显示
- 点击错误可以跳转到对应的日志位置

### 2. 下载完整日志

**方法1: 通过界面下载**
```
1. 在构建详情页面
2. 点击右上角的 "..." (三个点)
3. 选择 "Download log archive"
4. 解压zip文件查看完整日志
```

**方法2: 查看原始日志**
```
1. 在构建详情页面
2. 点击右上角的 "..." (三个点)
3. 选择 "View raw logs"
4. 可以直接在浏览器中查看完整日志
```

### 3. 重新运行构建

**重新运行所有任务:**
```
1. 在构建详情页面
2. 点击右上角的 "Re-run jobs"
3. 选择 "Re-run all jobs"
```

**只重新运行失败的任务:**
```
1. 在构建详情页面
2. 点击右上角的 "Re-run jobs"
3. 选择 "Re-run failed jobs"
```

### 4. 启用调试模式

**启用详细日志:**
```
1. 在构建详情页面
2. 点击 "Re-run jobs"
3. 勾选 "Enable debug logging"
4. 点击 "Re-run jobs"
```

这会输出更详细的调试信息,帮助定位问题。

---

## 📱 APK 安装和运行调试

### 1. 下载APK

**从GitHub Releases下载:**
```
1. 访问: https://github.com/369219053/wework-auto-reply/releases
2. 找到最新的Release
3. 下载 "app-release.apk" 文件
```

**从GitHub Actions下载:**
```
1. 访问成功的构建任务
2. 滚动到页面底部的 "Artifacts" 区域
3. 点击 "wework-auto-reply-apk" 下载
4. 解压zip文件获取APK
```

### 2. 安装APK到手机

**方法1: 直接安装**
```
1. 将APK文件传输到手机
2. 在手机上点击APK文件
3. 允许安装未知来源应用
4. 点击安装
```

**方法2: 使用ADB安装**
```bash
# 1. 连接手机到电脑(开启USB调试)
# 2. 在电脑上运行:
adb install app-release.apk

# 如果已安装,需要覆盖安装:
adb install -r app-release.apk
```

### 3. 配置权限

**必须开启的权限:**

1. **通知访问权限**
   ```
   设置 → 应用 → 特殊权限 → 通知访问权限
   → 找到"企微自动回复" → 开启
   ```

2. **无障碍服务权限**
   ```
   设置 → 辅助功能 → 已安装的服务
   → 找到"企微自动回复" → 开启
   ```

3. **悬浮窗权限(可选)**
   ```
   设置 → 应用 → 企微自动回复 → 权限
   → 悬浮窗 → 允许
   ```

---

## 📊 应用日志查看

### 1. 使用ADB查看实时日志

**基础命令:**
```bash
# 查看所有日志
adb logcat

# 只查看我们的应用日志
adb logcat | grep "WeWorkAutoReply"

# 清空日志后重新查看
adb logcat -c
adb logcat | grep "WeWorkAutoReply"
```

**过滤错误日志:**
```bash
# 只查看错误和警告
adb logcat *:E *:W

# 查看崩溃信息
adb logcat | grep "AndroidRuntime"
```

**保存日志到文件:**
```bash
# 保存到文件方便分析
adb logcat > app_log.txt

# 或者只保存我们的应用日志
adb logcat | grep "WeWorkAutoReply" > app_log.txt
```

### 2. 查看崩溃日志

**如果应用崩溃:**
```bash
# 查看最近的崩溃信息
adb logcat -d | grep "FATAL"

# 或者查看完整的崩溃堆栈
adb logcat -d | grep -A 50 "FATAL"
```

---

## 🔍 常见问题排查

### 问题1: 应用安装失败

**可能原因:**
- 手机系统版本过低(需要Android 7.0+)
- 未允许安装未知来源应用
- APK文件损坏

**解决方法:**
```
1. 检查手机系统版本: 设置 → 关于手机 → Android版本
2. 允许安装: 设置 → 安全 → 未知来源 → 允许
3. 重新下载APK文件
```

### 问题2: 应用无法监听通知

**可能原因:**
- 未开启通知访问权限
- 企业微信未安装
- 权限被系统回收

**解决方法:**
```
1. 重新检查通知访问权限是否开启
2. 确认企业微信已安装
3. 重启应用
4. 查看日志: adb logcat | grep "NotificationListener"
```

### 问题3: 自动回复不工作

**可能原因:**
- 无障碍服务未开启
- 配置的欢迎语为空
- 企业微信界面变化导致自动化失效

**解决方法:**
```
1. 检查无障碍服务是否开启
2. 打开应用,确认欢迎语和群聊链接已配置
3. 查看日志: adb logcat | grep "AutoReply"
4. 手动测试一次,观察日志输出
```

---

## 💻 本地开发调试(可选)

如果需要修改代码并快速测试,可以使用以下方法:

### 方法1: 使用Android Studio(完整开发环境)

**步骤:**
```
1. 下载安装Android Studio
2. 打开项目: File → Open → 选择wework-auto-reply文件夹
3. 等待Gradle同步完成
4. 连接手机,点击运行按钮
5. 可以实时调试和查看日志
```

### 方法2: 使用命令行快速构建(无需Android Studio)

**前提条件:**
- 已安装JDK 17
- 已安装Android SDK

**构建命令:**
```bash
# 进入项目目录
cd wework-auto-reply

# 构建APK
./gradlew assembleRelease

# APK输出位置:
# app/build/outputs/apk/release/app-release.apk

# 直接安装到手机
./gradlew installRelease
```

---

## 🎯 调试技巧总结

### 快速定位问题的步骤:

1. **先看GitHub Actions日志** - 确认APK是否成功构建
2. **检查APK安装** - 确认能否正常安装到手机
3. **检查权限配置** - 确认所有必要权限已开启
4. **查看应用日志** - 使用adb logcat查看运行时日志
5. **手动测试** - 发送测试好友申请,观察应用行为

### 常用调试命令速查:

```bash
# 查看连接的设备
adb devices

# 安装APK
adb install -r app-release.apk

# 卸载应用
adb uninstall com.wework.autoreply

# 查看应用日志
adb logcat | grep "WeWorkAutoReply"

# 查看崩溃日志
adb logcat -d | grep "FATAL"

# 重启应用
adb shell am force-stop com.wework.autoreply
adb shell am start -n com.wework.autoreply/.MainActivity
```

---

## 📞 需要帮助?

如果遇到无法解决的问题:

1. **收集信息:**
   - 手机型号和系统版本
   - 应用日志(adb logcat输出)
   - 问题复现步骤

2. **提供详细描述:**
   - 期望的行为
   - 实际的行为
   - 错误信息截图

3. **联系开发者**

---

**返回:** [README.md](../README.md)

